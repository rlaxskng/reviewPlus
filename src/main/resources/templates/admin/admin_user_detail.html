<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
                  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/table-scroll.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>ğŸ¬</text></svg>"></link>
    <title>ë¦¬ë·°í”ŒëŸ¬ìŠ¤ ê´€ë¦¬ì</title>
</head> 

<body>

	<!-- í—¤ë” -->
	<div id="header" th:fragment = "header">
		<div class="nav">
			<ul class="nav1">
				<li><a href="/"><img src="/images/logo.png" alt="logo" class="logoimg"></a></li>
				<li><a href="/Admin/AdminHome">ê´€ë¦¬ì í™ˆ</a></li>
				<li><a href="/logout">ë¡œê·¸ì•„ì›ƒ</a></li>
			</ul>
			<ul class="nav2">
				<li><a href="/Admin/AdminUser">íšŒì›ê´€ë¦¬</a></li>
				<li><a href="/Admin/AdminMovie">ì˜í™”ê´€ë¦¬</a></li>
				<li><a href="/Admin/AdminReview">ë¦¬ë·°ê´€ë¦¬</a></li>
			</ul>
		</div>
	</div>
<div class="list">
			<div class="list-title">íšŒì› ì •ë³´</div>
					<table class="detail-table">
						<tr>
							<td class="label-td"><label class="labelname">ê°€ì…ì¼</label></td>
							<td><input type="text"  class="inputbar" th:value="${#temporals.format(userDetails.createdAt , 'yyyy-MM-dd HH:mm:ss')}"  readonly></td>
						</tr>
						<tr>
							<td class="label-td"><label class="labelname">ì•„ì´ë””</label></td>
							<td><input type="text" class="inputbar" th:value="${userDetails.userId}" readonly></td>
						</tr>
						<tr>
							<td class="label-td"><label class="labelname">ì´ë¦„</label></td>
							<td><input type="text" class="inputbar" th:value="${userDetails.pname}" readonly></td>
						</tr>
						<tr>
							<td class="label-td"><label class="labelname">ë‹‰ë„¤ì„</label></td>
							<td><input type="text" class="inputbar" th:value="${userDetails.nickname}" readonly></td>
						</tr>
						<tr>
							<td class="label-td"><label class="labelname">ì´ë©”ì¼</label></td>
							<td><input type="text" class="inputbar" th:value="${userDetails.email}" readonly></td>
						</tr>
						<tr>
							<td class="label-td"><label class="labelname">ìƒë…„ì›”ì¼</label></td>
							<td><input type="text" class="inputbar" th:value="${userDetails.birthdate}" readonly></td>
						</tr>
						<tr>
							<td class="label-td"><label class="labelname">íšŒì›ìƒíƒœ</label></td>
							<td><input type="text" class="inputbar" th:value="${userDetails.role}" readonly></td>
						</tr>
					</table>
					<div class="btn-detail-container">
						<button type="button" class="btn-detail" onclick="openModal('editUserModal')">íšŒì›ìˆ˜ì •</button>
						<button type="submit" class="btn-detail" onclick="toggleStatusButtons('userStatusContainer')">íšŒì›ìƒíƒœë³€ê²½</button>
					</div>
					
					<!-- íšŒì› ìƒíƒœ ë³€ê²½ -->
					
				<form action = "/Admin/updateUserStatus" method = "post">
					<input type ="hidden" name ="userId" th:value ="${userDetails.userId}">
					<div id="userStatusContainer" class = "UserStatus">
						<button type="submit" class="btn-detail" name="status" value="ROLE_ADMIN">ê´€ë¦¬ì</button>
						<button type="submit" class="btn-detail" name="status" value="ROLE_USER">ì¼ë°˜íšŒì›</button>
						<button type="submit" class="btn-detail" name="status" value="ROLE_DORMANT">íœ´ë©´ìœ ì €</button>
					</div>
				</form>	
				
				<!-- íšŒì› ìˆ˜ì • ëª¨ë‹¬  -->
				<div id="editUserModal" class="modal">
				    <div class="modal-content">
				        <span class="close-button" onclick="closeModal('editUserModal')">ë‹«ê¸°</span>
				        <h2>íšŒì› ì •ë³´ ìˆ˜ì •</h2>
				        <form action = "/Admin/userEdit" method = "POST">
				        	<input type = "hidden" name = "userId" th:value ="${userDetails.userId}">
				            <label for="editNickname">ë‹‰ë„¤ì„:</label><br>
				            <input type="text" id="editNickname" name = "nickname" th:value="${userDetails.nickname}"><br>
				            <label for="editPname">ì´ë¦„:</label><br>
				            <input type="text" id="editPname" name = "pname" th:value="${userDetails.pname}"><br>
				            <label for="editBirthdate">ìƒë…„ì›”ì¼:</label><br>
				            <input type="text" id="editBirthdate" name = "birthdate" th:value="${userDetails.birthdate}"><br>
				            <label for="editEmail">ì´ë©”ì¼:</label><br>
				            <input type="text" id="editEmail" name = "email" th:value="${userDetails.email}"><br>
				            <button type="submit" class="btn-modal-edit">ìˆ˜ì •</button>
				        </form>
				    </div>
				</div>
				
				
				<!-- íšŒì› ìƒíƒœ ìˆ˜ì • ì„±ê³µ ë©”ì‹œì§€ -->
				<div th:if="${sucStatus}" class="alert alert-status">
				    <p th:text="${sucStatus}"></p>
				</div>
				
				<!-- ìˆ˜ì • ì„±ê³µ ë©”ì‹œì§€ -->
	            <div th:if="${suc}" class="alert alert-success">
				    <p th:text="${suc}"></p>
				</div>
				
				
				<!-- ìˆ˜ì • ì‹¤íŒ¨ ë©”ì‹œì§€ -->
	            <div th:if="${userEditError}" class="alert alert-danger">
				    <p th:text="${userEditError}"></p>
				</div>
				
				
			<!-- íšŒì› ë¦¬ë·° ëª©ë¡ -->	
		<div class="list-title">íšŒì› ë¦¬ë·° ëª©ë¡</div>
				<table class="table" >
					<thead>
						<tr>
							<th>ì˜í™” ì œëª©</th>
							<th>ë‹‰ë„¤ì„</th>
							<th>ë¦¬ë·° ë‚´ìš©</th>
							<th>í‰ì </th>
							<th>ë“±ë¡ì¼</th>
						</tr>
					</thead>	
					<tbody>
						<!-- th:block div ì²˜ëŸ¼ html ì†ì„±ì´ ë‚¨ëŠ”ê²Œ ì•„ë‹Œ html ìì²´ íƒœê·¸ ì—†ì´ ì¡°ê±´ë¬¸ ìƒì„±  -->
						<th:block th:if="${!#lists.isEmpty(allUserReviews)}">	
							<tr th:each = "userReviws : ${allUserReviews}"
								th:data-url="@{/Admin/AdminReviewDetail/{reviewId}(reviewId=${userReviws.reviewId})}"
								onclick="UserDetailLink(this);"
								id = "UserReviewsList">
								<td th:text = "${userReviws.title}"></td>
								<td th:text = "${userReviws.nickname}"></td>
								<td th:text = "${userReviws.comment}"></td>
								<td th:text = "${userReviws.rating}"></td>
								<td th:text = "${userReviws.regDate}"></td>
							</tr>
						</th:block>	
							<tr th:if="${#lists.isEmpty(allUserReviews)}">
							    <td colspan="5" style="text-align: center; color: black;">ì‚¬ìš©ìì˜ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
							</tr>
					</tbody>
				</table>
</div>
	
	
	<!-- íšŒì› ë¦¬ë·° í–‰ ì„ íƒì‹œ í•´ë‹¹ URLë¡œ ì´ë™ -->	
	<script>
			function UserDetailLink(rowElement){
				const url = rowElement.getAttribute('data-url');
				if(url){
					window.location.href = url;
				}
			}
	</script>
	
	
	<!-- ìˆ˜ì • ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    // ëª¨ë‹¬ ì—´ê¸°
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'block';
        }
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
        }
    }

    // ëª¨ë‹¬ ë°”ê¹¥ì„ í´ë¦­í•´ë„ ë‹«í˜
    window.onclick = function(event) {
        const modal = document.getElementById('editUserModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
</script>

<!-- íšŒì›ìƒíƒœ ìˆ˜ì •ì°½ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
function toggleStatusButtons(containerId){
	const container = document.getElementById(containerId)
	  if (container) {
          //show í´ë˜ìŠ¤ê°€ ìˆìœ¼ë©´ ì œê±°í•˜ê³ , ì—†ìœ¼ë©´ ì¶”ê°€í•¨
          container.classList.toggle('show');
      }
  }
</script>

	
</body>
</html>